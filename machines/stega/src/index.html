<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stega</title>
    <style>
      @import "./style.css";
    </style>
  </head>
  <body>
    <button class="drawer-toggle" id="drawer-toggle">Menu</button>

    <div class="drawer" id="drawer">
      <h1>Stega</h1>
      <div class="drawer-section">
        <label>View</label>
        <select id="view-select">
          <option value="create" selected>Encode Audio</option>
          <option value="create-key">Create Key</option>
          <option value="playback">Playback</option>
          <option value="mix">Mix</option>
        </select>
      </div>

      <div class="drawer-section">
        <label>Playback</label>
        <div class="button-group">
          <button id="play-pause">Play</button>
          <button id="record-btn" class="btn-record">Record</button>
        </div>
      </div>

      <div class="drawer-section">
        <label>Global BPM</label>
        <input type="number" id="global-bpm" value="120" />
      </div>

      <div class="drawer-section">
        <label>Global Pitch</label>
        <input type="number" id="global-pitch" value="0" />
      </div>

      <div class="drawer-section-divided">
        <label>Tracks</label>
        <div id="track-controls-list"></div>
      </div>

      <div class="drawer-section hidden" id="recording-preview-container">
        <label>Recording Preview</label>
        <img id="recording-preview-img" class="preview-image" />
        <div class="flex-group">
          <button id="recording-add-btn">Add to Mixer</button>
          <a
            id="recording-download-link"
            href="#"
            download="stega-mix.png"
            class="btn btn-inline"
            >Download</a
          >
        </div>
      </div>
    </div>

    <div class="main-area">
      <!-- Encoder Panel -->
      <div class="panel panel-centered" id="panel-create">
        <div class="smart-drop-zone" id="encoder-drop">
          <button id="encoder-file-btn">Choose Audio/Video</button>
          <span id="encoder-file-name" class="file-name">No file chosen</span>
          <input
            type="file"
            id="encoder-input"
            accept="audio/*,video/*"
            class="hidden"
          />
        </div>

        <div id="encoder-controls" class="hidden controls-header">
          <div class="section-divider">
            <label>Zoom (Coarse)</label>
            <canvas id="waveform-canvas" class="waveform-canvas"></canvas>
            <div class="range-slider-container">
              <div class="range-slider-track"></div>
              <div class="range-slider-highlight" id="zoom-highlight"></div>
              <input
                type="range"
                class="range-slider-input no-track"
                id="zoom-slider-start"
                min="0"
                max="100"
                value="0"
                step="0.001"
              />
              <input
                type="range"
                class="range-slider-input no-track"
                id="zoom-slider-end"
                min="0"
                max="100"
                value="100"
                step="0.001"
              />
            </div>

            <label>Trim (Fine)</label>
            <canvas id="waveform-canvas-fine" class="waveform-canvas"></canvas>
            <div class="range-slider-container">
              <div class="range-slider-track"></div>
              <div class="range-slider-highlight" id="trim-highlight"></div>
              <input
                type="range"
                class="range-slider-input no-track"
                id="trim-slider-start"
                min="0"
                max="100"
                value="0"
                step="0.001"
              />
              <input
                type="range"
                class="range-slider-input no-track"
                id="trim-slider-end"
                min="0"
                max="100"
                value="100"
                step="0.001"
              />
            </div>

            <div class="flex-group">
              <div class="flex-col">
                <label>Start</label>
                <input
                  type="number"
                  id="trim-start"
                  value="0"
                  step="0.01"
                  min="0"
                />
              </div>
              <div class="flex-col">
                <label>End</label>
                <input
                  type="number"
                  id="trim-end"
                  value="0"
                  step="0.01"
                  min="0"
                />
              </div>
            </div>
            <div class="button-group">
              <button id="preview-play">Play Loop</button>
              <button id="preview-stop">Stop</button>
            </div>
          </div>

          <div class="controls-grid">
            <div>
              <label>BPM</label>
              <div class="flex-center">
                <input type="number" id="encoder-bpm" value="120" />
                <button id="detect-bpm-btn" class="btn-small">Tap</button>
              </div>

              <label>Pitch (Semitones)</label>
              <input type="number" id="encoder-pitch" value="0" />

              <label>Sample Rate (Hz)</label>
              <div class="flex-center">
                <input
                  type="number"
                  id="encoder-sample-rate-input"
                  value="44100"
                  min="4000"
                  max="48000"
                  step="100"
                />
              </div>
              <label>Sample Rate Slider</label>
              <input
                type="range"
                id="encoder-sample-rate"
                min="4000"
                max="48000"
                step="100"
                value="44100"
              />
              <label>Downsample Mode</label>
              <select id="encoder-resample">
                <option value="resample" selected>
                  Resample (maintain speed, reduce size)
                </option>
                <option value="slow">
                  Transform playback (keep sample count)
                </option>
              </select>

              <label>Image</label>
              <div class="smart-drop-zone" id="encoder-image-drop">
                <button id="encoder-image-btn">Choose Image</button>
                <span id="encoder-image-name" class="file-name"
                  >No image chosen</span
                >
                <input
                  type="file"
                  id="encoder-image-input"
                  accept="image/*"
                  class="hidden"
                />
              </div>
            </div>
            <div>
              <label>Channels</label>
              <select id="encoder-channels">
                <option value="1">Mono</option>
                <option value="2" selected>Stereo</option>
              </select>

              <label>Bit Depth</label>
              <select id="encoder-bit-depth">
                <option value="24">24-bit</option>
                <option value="16" selected>16-bit</option>
                <option value="8">8-bit</option>
              </select>

              <label>Encoding Algorithm</label>
              <select id="encoder-encoding">
                <option value="additive" selected>Additive</option>
                <option value="subtractive">Subtractive</option>
                <option value="difference">Difference</option>
                <option value="bitshift">Bitshift</option>
                <option value="solid">Solid</option>
                <option value="noise">Noise</option>
              </select>

              <label>Encoding Tiling</label>
              <select id="encoder-tiling">
                <option value="none" selected>None</option>
                <option value="columns">Columns</option>
                <option value="rows">Rows</option>
                <option value="quarters">Quarters</option>
              </select>

              <label>Border Width (px)</label>
              <input
                type="number"
                id="encoder-border-width"
                value="1"
                min="1"
              />

              <label>Direction</label>
              <select id="encoder-direction">
                <option value="forward" selected>Forward</option>
                <option value="reverse">Reverse</option>
              </select>

              <label>Encryption Key</label>
              <select id="encoder-key-type">
                <option value="none" selected>None</option>
                <option value="string">String</option>
                <option value="image">Image</option>
              </select>

              <div id="encoder-key-string-container" class="hidden">
                <label>Key String</label>
                <input
                  type="text"
                  id="encoder-key-string"
                  placeholder="Enter key string"
                />
              </div>

              <div id="encoder-key-image-container" class="hidden">
                <label>Key Image</label>
                <div class="smart-drop-zone" id="encoder-key-image-drop">
                  <button id="encoder-key-image-btn">Choose Key Image</button>
                  <span id="encoder-key-image-name" class="file-name"
                    >No key image</span
                  >
                  <input
                    type="file"
                    id="encoder-key-image-input"
                    accept="image/*"
                    class="hidden"
                  />
                </div>
              </div>
            </div>
          </div>

          <button id="encode-btn" class="controls-header">Encode Image</button>
        </div>

        <div id="generated-controls" class="hidden generated-section">
          <div class="button-row">
            <button id="play-generated-btn">Play Generated Loop</button>
            <button id="stop-generated-btn">Stop</button>
            <button id="download-generated-btn">Download Image</button>
          </div>
          <img id="encoded-image" class="hidden" />
        </div>
      </div>

      <!-- Key Encoder Panel Removed -->

      <!-- Create Key Panel -->
      <div class="panel panel-centered hidden" id="panel-create-key">
        <div class="controls-header">
          <div class="section-divider">
            <label>Key Generation</label>
            <div class="flex-group">
              <div class="flex-col">
                <label>Key Length (characters)</label>
                <input
                  type="number"
                  id="key-length"
                  value="256"
                  min="16"
                  max="10000"
                />
              </div>
            </div>
            <button id="generate-key-btn">Generate Random Key</button>
            <div class="flex-col">
              <label>Generated Key String</label>
              <textarea id="generated-key-string" rows="4" readonly></textarea>
            </div>
          </div>

          <div class="controls-grid">
            <div>
              <label>Source Image</label>
              <div class="smart-drop-zone" id="create-key-image-drop">
                <button id="create-key-image-btn">Choose Image</button>
                <span id="create-key-image-name" class="file-name"
                  >No image chosen</span
                >
                <input
                  type="file"
                  id="create-key-image-input"
                  accept="image/*"
                  class="hidden"
                />
              </div>

              <label>Encoding</label>
              <select id="create-key-encoding">
                <option value="base64" selected>Base64</option>
                <option value="raw">Raw</option>
              </select>

              <label>Border Width (px)</label>
              <input
                type="number"
                id="create-key-border-width"
                value="1"
                min="0"
              />
            </div>
            <div>
              <label>Min Width (px)</label>
              <input
                type="number"
                id="create-key-min-width"
                value="256"
                min="16"
              />

              <label>Min Height (px)</label>
              <input
                type="number"
                id="create-key-min-height"
                value="256"
                min="16"
              />

              <label>Aspect Ratio</label>
              <select id="create-key-aspect-ratio">
                <option value="undefined" selected>Auto</option>
                <option value="1">1:1 (Square)</option>
                <option value="1.7778">16:9</option>
                <option value="1.3334">4:3</option>
              </select>
            </div>
          </div>

          <button id="encode-key-btn" class="controls-header">
            Encode Key into Image
          </button>
        </div>

        <div id="create-key-result" class="hidden generated-section">
          <div class="button-row">
            <button id="download-key-image-btn">Download Key Image</button>
            <button id="copy-key-string-btn">Copy Key String</button>
          </div>
          <img id="key-result-image" class="hidden" />
        </div>
      </div>

      <!-- Playback Panel -->
      <div class="panel panel-centered hidden" id="panel-playback">
        <div class="smart-drop-zone" id="playback-image-drop">
          <button id="playback-image-btn">Choose Stega Image</button>
          <span id="playback-image-name" class="file-name"
            >No image chosen</span
          >
          <input
            type="file"
            id="playback-image-input"
            accept="image/*"
            class="hidden"
          />
        </div>

        <div id="playback-controls" class="hidden controls-header">
          <div class="section-divider">
            <label>Decryption Key</label>
            <select id="playback-key-type">
              <option value="none" selected>None</option>
              <option value="string">String</option>
              <option value="image">Image</option>
            </select>

            <div id="playback-key-string-container" class="hidden">
              <label>Key String</label>
              <input
                type="text"
                id="playback-key-string"
                placeholder="Enter key string"
              />
            </div>

            <div id="playback-key-image-container" class="hidden">
              <label>Key Image</label>
              <div class="smart-drop-zone" id="playback-key-image-drop">
                <button id="playback-key-image-btn">Choose Key Image</button>
                <span id="playback-key-image-name" class="file-name"
                  >No key image</span
                >
                <input
                  type="file"
                  id="playback-key-image-input"
                  accept="image/*"
                  class="hidden"
                />
              </div>
            </div>
          </div>

          <div class="section-divider">
            <label>Metadata</label>
            <pre id="playback-metadata">Loading...</pre>
          </div>

          <div class="button-row">
            <button id="playback-play-pause-btn">Play</button>
          </div>

          <div class="image-preview-container">
            <div class="preview-box">
              <label>Stega Image</label>
              <img id="playback-preview-stega" class="pixelated-preview" />
            </div>
            <div class="preview-box">
              <label>Key Image</label>
              <img id="playback-preview-key" class="pixelated-preview" />
            </div>
          </div>
        </div>
      </div>

      <!-- Mixer Panel -->
      <div class="panel hidden" id="panel-mix">
        <div class="drop-zone mixer-container" id="mixer-drop">
          <div class="smart-drop-zone mixer-drop-header" id="mixer-drop-zone">
            <button id="mixer-add-btn">Add Image</button>
            <span class="file-name">Drop images here to add tracks</span>
            <input
              type="file"
              id="mixer-file-input"
              accept="image/*"
              multiple
              class="hidden"
            />
          </div>
          <div id="tracks"></div>
        </div>
      </div>
    </div>

    <script type="module">
      import "./index.ts";
    </script>
  </body>
</html>
