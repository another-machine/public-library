<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stega</title>
    <style>
      body {
        font-family: sans-serif;
        background: #000;
        color: #fff;
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
      }
      h1 {
        font-weight: 300;
        margin: 0;
        font-size: 1.2em;
      }
      .drawer {
        position: fixed;
        top: 0;
        right: 0;
        width: 300px;
        height: 100%;
        background: #222;
        padding: 20px;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.5);
        transform: translateX(100%);
        transition: transform 0.3s ease;
        z-index: 100;
        overflow-y: auto;
      }
      .drawer.open {
        transform: translateX(0);
      }
      .drawer-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 101;
        width: auto;
        padding: 10px 15px;
        background: #333;
        border: 1px solid #444;
        border-radius: 4px;
        cursor: pointer;
      }
      .main-area {
        width: 100%;
        height: 100%;
        padding: 20px;
        box-sizing: border-box;
        overflow-y: auto;
      }
      .container {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }
      .panel {
        background: transparent;
        padding: 0;
        border-radius: 0;
        flex: 1;
        min-width: 300px;
      }
      .drop-zone {
        border: 2px dashed #444;
        border-radius: 8px;
        padding: 40px;
        text-align: center;
        color: #888;
        transition: border-color 0.2s, color 0.2s;
        cursor: pointer;
      }
      .drop-zone.drag-over {
        border-color: #fff;
        color: #fff;
      }
      input,
      button,
      select {
        background: #333;
        border: 1px solid #444;
        color: #fff;
        padding: 8px;
        border-radius: 4px;
        margin-bottom: 10px;
        width: 100%;
        box-sizing: border-box;
      }
      button,
      .btn {
        cursor: pointer;
        background: #444;
        border: 1px solid #444;
        color: #fff;
        padding: 8px;
        border-radius: 4px;
        margin-bottom: 10px;
        width: 100%;
        box-sizing: border-box;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 13px; /* Match default button font size */
      }
      button:hover,
      .btn:hover {
        background: #555;
      }
      button:disabled,
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      label {
        display: block;
        margin-bottom: 4px;
        font-size: 0.9em;
        color: #aaa;
      }
      #encoded-image {
        max-width: 100%;
        margin-top: 20px;
        display: none;
      }
      .track {
        background: transparent;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        flex: 1;
        vertical-align: top;
        position: relative;

        canvas {
          width: 100%;
          height: auto;
          max-width: 500px;
        }
      }
      .track:hover .track-controls {
        opacity: 1;
      }
      /* Dual Range Slider Styles */
      .range-slider-container {
        position: relative;
        height: 30px;
        margin-bottom: 15px;
      }
      .range-slider-track {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        height: 4px;
        width: 100%;
        background: #444;
        border-radius: 2px;
      }
      .range-slider-highlight {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        height: 4px;
        background: #fff;
        border-radius: 2px;
        pointer-events: none;
      }
      .range-slider-input {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 100%;
        background: none;
        pointer-events: none;
        -webkit-appearance: none;
        appearance: none;
        margin: 0;
      }
      .range-slider-input::-webkit-slider-thumb {
        -webkit-appearance: none;
        pointer-events: auto;
        width: 16px;
        height: 16px;
        background: #fff;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid #333;
      }
      .range-slider-input::-moz-range-thumb {
        pointer-events: auto;
        width: 16px;
        height: 16px;
        background: #fff;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid #333;
      }
      .controls-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      @media (max-width: 600px) {
        .controls-grid {
          grid-template-columns: 1fr;
        }
      }
      .track-controls {
        opacity: 0;
        transition: opacity 0.2s;
        background: rgba(0, 0, 0, 0.8);
        padding: 10px;
        border-radius: 4px;
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        width: 200px;
      }
      .track-info {
        font-size: 0.8em;
        text-align: center;
        color: #888;
      }
      #tracks {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        align-items: center;
        min-height: 300px;
      }
    </style>
  </head>
  <body>
    <button class="drawer-toggle" id="drawer-toggle">â˜° Settings</button>

    <div class="drawer" id="drawer">
      <h1>Stega</h1>
      <div style="margin-top: 20px">
        <label>View</label>
        <div style="display: flex; gap: 10px">
          <button id="view-create">Create</button>
          <button id="view-mix">Mix</button>
        </div>
      </div>

      <div style="margin-top: 20px">
        <label>Playback</label>
        <div style="display: flex; gap: 10px">
          <button id="play-pause">Play</button>
          <button id="record-btn" style="background: #822">Record</button>
        </div>
      </div>

      <div style="margin-top: 20px">
        <label>Global BPM</label>
        <input type="number" id="global-bpm" value="120" />
      </div>

      <div style="margin-top: 20px">
        <label>Global Pitch</label>
        <input type="number" id="global-pitch" value="0" />
      </div>

      <div
        style="margin-top: 20px; border-top: 1px solid #444; padding-top: 20px"
      >
        <label>Tracks</label>
        <div id="track-controls-list"></div>
      </div>

      <div
        style="margin-top: 20px; display: none"
        id="recording-preview-container"
      >
        <label>Recording Preview</label>
        <img
          id="recording-preview-img"
          style="width: 100%; margin-bottom: 10px; border: 1px solid #444"
        />
        <a
          id="recording-download-link"
          href="#"
          download="stega-mix.png"
          style="color: #fff; text-decoration: underline"
          >Download Recording</a
        >
      </div>
    </div>

    <div class="main-area">
      <!-- Encoder Panel -->
      <div
        class="panel"
        id="panel-create"
        style="display: none; max-width: 600px; margin: 0 auto"
      >
        <h2>Create Loop</h2>
        <div class="drop-zone" id="encoder-drop">
          Drop Audio or Click to Upload
          <input
            type="file"
            id="encoder-input"
            accept="audio/*"
            style="display: none"
          />
        </div>

        <div id="encoder-controls" style="display: none; margin-top: 20px">
          <div
            style="
              margin-bottom: 15px;
              padding-bottom: 15px;
              border-bottom: 1px solid #444;
            "
          >
            <label>Trim Loop (seconds)</label>

            <div class="range-slider-container">
              <div class="range-slider-track"></div>
              <div class="range-slider-highlight" id="trim-highlight"></div>
              <input
                type="range"
                class="range-slider-input"
                id="trim-slider-start"
                min="0"
                max="100"
                value="0"
                step="0.01"
              />
              <input
                type="range"
                class="range-slider-input"
                id="trim-slider-end"
                min="0"
                max="100"
                value="100"
                step="0.01"
              />
            </div>

            <div style="display: flex; gap: 10px; margin-bottom: 10px">
              <div style="flex: 1">
                <label>Start</label>
                <input
                  type="number"
                  id="trim-start"
                  value="0"
                  step="0.01"
                  min="0"
                />
              </div>
              <div style="flex: 1">
                <label>End</label>
                <input
                  type="number"
                  id="trim-end"
                  value="0"
                  step="0.01"
                  min="0"
                />
              </div>
            </div>
            <div style="display: flex; gap: 10px">
              <button id="preview-play">Play Loop</button>
              <button id="preview-stop">Stop</button>
            </div>
          </div>

          <div class="controls-grid">
            <div>
              <label>BPM</label>
              <input type="number" id="encoder-bpm" value="120" />

              <label>Pitch (Semitones)</label>
              <input type="number" id="encoder-pitch" value="0" />

              <label
                >Sample Rate:
                <span id="sample-rate-display">44100</span> Hz</label
              >
              <input
                type="range"
                id="encoder-sample-rate"
                min="4000"
                max="48000"
                step="100"
                value="44100"
              />
            </div>
            <div>
              <label>Bit Depth</label>
              <select id="encoder-bit-depth">
                <option value="24">24-bit</option>
                <option value="16" selected>16-bit</option>
                <option value="8">8-bit</option>
              </select>

              <label>Encoding Algorithm</label>
              <select id="encoder-encoding">
                <option value="additive" selected>Additive</option>
                <option value="subtractive">Subtractive</option>
                <option value="difference">Difference</option>
                <option value="noise">Noise</option>
              </select>

              <label>Border Width (px)</label>
              <input
                type="number"
                id="encoder-border-width"
                value="1"
                min="1"
              />

              <label>Image</label>
              <input type="file" id="encoder-image-input" accept="image/*" />
            </div>
          </div>

          <button id="encode-btn" style="margin-top: 20px">Encode Image</button>
        </div>

        <div
          id="generated-controls"
          style="
            display: none;
            margin-top: 20px;
            border-top: 1px solid #444;
            padding-top: 20px;
          "
        >
          <div
            style="
              display: flex;
              gap: 10px;
              margin-bottom: 10px;
              align-items: center;
            "
          >
            <button id="play-generated-btn">Play Generated Loop</button>
            <button id="stop-generated-btn">Stop</button>
            <button id="download-generated-btn">Download Image</button>
          </div>
          <img id="encoded-image" />
        </div>
      </div>

      <!-- Mixer Panel -->
      <div class="panel" id="panel-mix">
        <div
          class="drop-zone"
          id="mixer-drop"
          style="
            border: none;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
          "
        >
          <div id="tracks"></div>
        </div>
      </div>
    </div>

    <script type="module" src="./index.ts"></script>
  </body>
</html>
