<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stega</title>
    <style>
      body {
        font-family: sans-serif;
        background: #000;
        color: #fff;
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
      }
      h1 {
        font-weight: 300;
        margin: 0;
        font-size: 1.2em;
      }
      .drawer {
        position: fixed;
        top: 0;
        right: 0;
        width: 300px;
        height: 100%;
        background: #222;
        padding: 20px;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.5);
        transform: translateX(100%);
        transition: transform 0.3s ease;
        z-index: 100;
        overflow-y: auto;
      }
      .drawer.open {
        transform: translateX(0);
      }
      .drawer-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 101;
        width: auto;
        padding: 10px 15px;
        background: #333;
        border: 1px solid #444;
        border-radius: 4px;
        cursor: pointer;
      }
      .main-area {
        width: 100%;
        height: 100%;
        padding: 20px;
        box-sizing: border-box;
        overflow-y: auto;
      }
      .container {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }
      .panel {
        background: transparent;
        padding: 0;
        border-radius: 0;
        flex: 1;
        min-width: 300px;
      }
      .drop-zone {
        border: 2px dashed #444;
        border-radius: 8px;
        padding: 40px;
        text-align: center;
        color: #888;
        transition: border-color 0.2s, color 0.2s;
        cursor: pointer;
      }
      .drop-zone.drag-over {
        border-color: #fff;
        color: #fff;
      }
      input,
      button,
      select {
        background: #333;
        border: 1px solid #444;
        color: #fff;
        padding: 8px;
        border-radius: 4px;
        margin-bottom: 10px;
        width: 100%;
        box-sizing: border-box;
      }
      select {
        -webkit-appearance: none;
        appearance: none;
        background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
        background-repeat: no-repeat;
        background-position: right 10px top 50%;
        background-size: 10px auto;
        padding-right: 30px;
      }
      button,
      .btn {
        cursor: pointer;
        background: #444;
        border: 1px solid #444;
        color: #fff;
        padding: 8px;
        border-radius: 4px;
        margin-bottom: 10px;
        width: 100%;
        box-sizing: border-box;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 13px; /* Match default button font size */
      }
      button:hover,
      .btn:hover {
        background: #555;
      }
      button:disabled,
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      label {
        display: block;
        margin-bottom: 4px;
        font-size: 0.9em;
        color: #aaa;
      }
      #encoded-image {
        max-width: 100%;
        margin-top: 20px;
        display: none;
      }
      .track {
        background: transparent;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        flex: 1;
        vertical-align: top;
        position: relative;

        canvas {
          image-rendering: pixelated;
          width: 100%;
          height: auto;
          max-width: 700px;
          box-shadow: 0 0 0 1px rgba(255, 255, 255, var(--opacity, 0));
        }
      }
      .track:hover .track-controls {
        opacity: 1;
      }
      /* Dual Range Slider Styles */
      .range-slider-container {
        position: relative;
        height: 30px;
        margin-bottom: 15px;
      }
      .range-slider-track {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        height: 1px;
        width: 100%;
        background: #444;
      }
      .range-slider-highlight {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        height: 1px;
        background: #fff;
        pointer-events: none;
      }
      .range-slider-input {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 100%;
        background: none;
        pointer-events: none;
        -webkit-appearance: none;
        appearance: none;
        margin: 0;
        border: none; /* Remove default border */
      }
      .range-slider-input::-webkit-slider-thumb {
        -webkit-appearance: none;
        pointer-events: auto;
        width: 30px;
        height: 30px;
        background: linear-gradient(
          to right,
          transparent 14px,
          #fff 14px,
          #fff 16px,
          transparent 16px
        );
        cursor: pointer;
        border: none;
        border-radius: 0;
      }
      .range-slider-input::-moz-range-thumb {
        pointer-events: auto;
        width: 30px;
        height: 30px;
        background: linear-gradient(
          to right,
          transparent 14px,
          #fff 14px,
          #fff 16px,
          transparent 16px
        );
        cursor: pointer;
        border: none;
        border-radius: 0;
      }

      /* General Range Input Styles */
      input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 30px; /* Container height */
        background: transparent;
        border: none;
        margin: 0;
        padding: 0;
      }
      input[type="range"]::-webkit-slider-runnable-track {
        width: 100%;
        height: 1px;
        background: #444;
        cursor: pointer;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 30px;
        width: 30px;
        background: linear-gradient(
          to right,
          transparent 14px,
          #fff 14px,
          #fff 16px,
          transparent 16px
        );
        cursor: pointer;
        margin-top: -14.5px; /* (30px - 1px) / 2 * -1 */
        border: none;
        border-radius: 0;
      }
      input[type="range"]::-moz-range-track {
        width: 100%;
        height: 1px;
        background: #444;
        cursor: pointer;
      }
      input[type="range"]::-moz-range-thumb {
        height: 30px;
        width: 30px;
        background: linear-gradient(
          to right,
          transparent 14px,
          #fff 14px,
          #fff 16px,
          transparent 16px
        );
        cursor: pointer;
        border: none;
        border-radius: 0;
      }
      input[type="range"]:focus {
        outline: none;
      }

      .controls-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      @media (max-width: 600px) {
        .controls-grid {
          grid-template-columns: 1fr;
        }
      }
      .track-controls {
        opacity: 0;
        transition: opacity 0.2s;
        background: rgba(0, 0, 0, 0.8);
        padding: 10px;
        border-radius: 4px;
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        width: 200px;
      }
      .track-info {
        font-size: 0.8em;
        text-align: center;
        color: #888;
      }
      #tracks {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        align-items: center;
        min-height: 300px;
      }
    </style>
  </head>
  <body>
    <button class="drawer-toggle" id="drawer-toggle">â˜° Settings</button>

    <div class="drawer" id="drawer">
      <h1>Stega</h1>
      <div style="margin-top: 20px">
        <label>View</label>
        <div style="display: flex; gap: 10px">
          <button id="view-create">Create</button>
          <button id="view-mix">Mix</button>
        </div>
      </div>

      <div style="margin-top: 20px">
        <label>Playback</label>
        <div style="display: flex; gap: 10px">
          <button id="play-pause">Play</button>
          <button id="record-btn" style="background: #822">Record</button>
        </div>
      </div>

      <div style="margin-top: 20px">
        <label>Global BPM</label>
        <input type="number" id="global-bpm" value="120" />
      </div>

      <div style="margin-top: 20px">
        <label>Global Pitch</label>
        <input type="number" id="global-pitch" value="0" />
      </div>

      <div
        style="margin-top: 20px; border-top: 1px solid #444; padding-top: 20px"
      >
        <label>Tracks</label>
        <div id="track-controls-list"></div>
      </div>

      <div
        style="margin-top: 20px; display: none"
        id="recording-preview-container"
      >
        <label>Recording Preview</label>
        <img
          id="recording-preview-img"
          style="width: 100%; margin-bottom: 10px; border: 1px solid #444"
        />
        <div style="display: flex; gap: 10px; margin-bottom: 10px">
          <button id="recording-add-btn">Add to Mixer</button>
          <a
            id="recording-download-link"
            href="#"
            download="stega-mix.png"
            class="btn"
            style="line-height: 1.2"
            >Download</a
          >
        </div>
      </div>
    </div>

    <div class="main-area">
      <!-- Encoder Panel -->
      <div
        class="panel"
        id="panel-create"
        style="display: none; max-width: 600px; margin: 0 auto"
      >
        <h2>Create Loop</h2>
        <div class="drop-zone" id="encoder-drop">
          Drop Audio or Click to Upload
          <input
            type="file"
            id="encoder-input"
            accept="audio/*"
            style="display: none"
          />
        </div>

        <div id="encoder-controls" style="display: none; margin-top: 20px">
          <div
            style="
              margin-bottom: 15px;
              padding-bottom: 15px;
              border-bottom: 1px solid #444;
            "
          >
            <label>Zoom (Coarse)</label>
            <div class="range-slider-container">
              <div class="range-slider-track"></div>
              <div class="range-slider-highlight" id="zoom-highlight"></div>
              <input
                type="range"
                class="range-slider-input"
                id="zoom-slider-start"
                min="0"
                max="100"
                value="0"
                step="0.01"
              />
              <input
                type="range"
                class="range-slider-input"
                id="zoom-slider-end"
                min="0"
                max="100"
                value="100"
                step="0.01"
              />
            </div>

            <label>Trim (Fine)</label>
            <div class="range-slider-container">
              <div class="range-slider-track"></div>
              <div class="range-slider-highlight" id="trim-highlight"></div>
              <input
                type="range"
                class="range-slider-input"
                id="trim-slider-start"
                min="0"
                max="100"
                value="0"
                step="0.01"
              />
              <input
                type="range"
                class="range-slider-input"
                id="trim-slider-end"
                min="0"
                max="100"
                value="100"
                step="0.01"
              />
            </div>

            <div style="display: flex; gap: 10px; margin-bottom: 10px">
              <div style="flex: 1">
                <label>Start</label>
                <input
                  type="number"
                  id="trim-start"
                  value="0"
                  step="0.01"
                  min="0"
                />
              </div>
              <div style="flex: 1">
                <label>End</label>
                <input
                  type="number"
                  id="trim-end"
                  value="0"
                  step="0.01"
                  min="0"
                />
              </div>
            </div>
            <div style="display: flex; gap: 10px">
              <button id="preview-play">Play Loop</button>
              <button id="preview-stop">Stop</button>
            </div>
          </div>

          <div class="controls-grid">
            <div>
              <label>BPM</label>
              <div style="display: flex; gap: 5px">
                <input type="number" id="encoder-bpm" value="120" />
                <button
                  id="detect-bpm-btn"
                  style="width: auto; padding: 0 10px; font-size: 0.8em"
                >
                  Detect
                </button>
              </div>

              <label>Pitch (Semitones)</label>
              <div style="display: flex; gap: 5px">
                <input type="number" id="encoder-pitch" value="0" />
                <button
                  id="detect-key-btn"
                  style="width: auto; padding: 0 10px; font-size: 0.8em"
                >
                  Detect
                </button>
              </div>

              <label>Sample Rate (Hz)</label>
              <div style="display: flex; gap: 5px; align-items: center">
                <input
                  type="number"
                  id="encoder-sample-rate-input"
                  value="44100"
                  min="4000"
                  max="48000"
                  step="100"
                />
              </div>
              <input
                type="range"
                id="encoder-sample-rate"
                min="4000"
                max="48000"
                step="100"
                value="44100"
              />
            </div>
            <div>
              <label>Channels</label>
              <select id="encoder-channels">
                <option value="1">Mono</option>
                <option value="2" selected>Stereo</option>
              </select>

              <label>Bit Depth</label>
              <select id="encoder-bit-depth">
                <option value="24">24-bit</option>
                <option value="16" selected>16-bit</option>
                <option value="8">8-bit</option>
              </select>

              <label>Encoding Algorithm</label>
              <select id="encoder-encoding">
                <option value="additive" selected>Additive</option>
                <option value="subtractive">Subtractive</option>
                <option value="difference">Difference</option>
                <option value="noise">Noise</option>
              </select>

              <label>Border Width (px)</label>
              <input
                type="number"
                id="encoder-border-width"
                value="1"
                min="1"
              />

              <label>Image</label>
              <input type="file" id="encoder-image-input" accept="image/*" />
            </div>
          </div>

          <button id="encode-btn" style="margin-top: 20px">Encode Image</button>
        </div>

        <div
          id="generated-controls"
          style="
            display: none;
            margin-top: 20px;
            border-top: 1px solid #444;
            padding-top: 20px;
          "
        >
          <div
            style="
              display: flex;
              gap: 10px;
              margin-bottom: 10px;
              align-items: center;
            "
          >
            <button id="play-generated-btn">Play Generated Loop</button>
            <button id="stop-generated-btn">Stop</button>
            <button id="download-generated-btn">Download Image</button>
          </div>
          <img id="encoded-image" />
        </div>
      </div>

      <!-- Mixer Panel -->
      <div class="panel" id="panel-mix">
        <div
          class="drop-zone"
          id="mixer-drop"
          style="
            border: none;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
          "
        >
          <div id="tracks"></div>
        </div>
      </div>
    </div>

    <script type="module" src="./index.ts"></script>
  </body>
</html>
