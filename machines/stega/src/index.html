<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stega</title>
    <style>
      @import "./style.css";
    </style>
  </head>
  <body>
    <button class="drawer-toggle" id="drawer-toggle">Menu</button>

    <div class="drawer" id="drawer">
      <h1>Stega</h1>
      <div class="drawer-section">
        <label>View</label>
        <div class="button-group">
          <button id="view-create" class="active">Create</button>
          <button id="view-mix">Mix</button>
        </div>
      </div>

      <div class="drawer-section">
        <label>Playback</label>
        <div class="button-group">
          <button id="play-pause">Play</button>
          <button id="record-btn" class="btn-record">Record</button>
        </div>
      </div>

      <div class="drawer-section">
        <label>Global BPM</label>
        <input type="number" id="global-bpm" value="120" />
      </div>

      <div class="drawer-section">
        <label>Global Pitch</label>
        <input type="number" id="global-pitch" value="0" />
      </div>

      <div class="drawer-section-divided">
        <label>Tracks</label>
        <div id="track-controls-list"></div>
      </div>

      <div class="drawer-section hidden" id="recording-preview-container">
        <label>Recording Preview</label>
        <img id="recording-preview-img" class="preview-image" />
        <div class="flex-group">
          <button id="recording-add-btn">Add to Mixer</button>
          <a
            id="recording-download-link"
            href="#"
            download="stega-mix.png"
            class="btn btn-inline"
            >Download</a
          >
        </div>
      </div>
    </div>

    <div class="main-area">
      <!-- Encoder Panel -->
      <div class="panel panel-centered" id="panel-create">
        <div class="smart-drop-zone" id="encoder-drop">
          <button id="encoder-file-btn">Choose Audio</button>
          <span id="encoder-file-name" class="file-name">No audio chosen</span>
          <input
            type="file"
            id="encoder-input"
            accept="audio/*"
            class="hidden"
          />
        </div>

        <div id="encoder-controls" class="hidden controls-header">
          <div class="section-divider">
            <label>Zoom (Coarse)</label>
            <canvas id="waveform-canvas" class="waveform-canvas"></canvas>
            <div class="range-slider-container">
              <div class="range-slider-track"></div>
              <div class="range-slider-highlight" id="zoom-highlight"></div>
              <input
                type="range"
                class="range-slider-input no-track"
                id="zoom-slider-start"
                min="0"
                max="100"
                value="0"
                step="0.001"
              />
              <input
                type="range"
                class="range-slider-input no-track"
                id="zoom-slider-end"
                min="0"
                max="100"
                value="100"
                step="0.001"
              />
            </div>

            <label>Trim (Fine)</label>
            <canvas id="waveform-canvas-fine" class="waveform-canvas"></canvas>
            <div class="range-slider-container">
              <div class="range-slider-track"></div>
              <div class="range-slider-highlight" id="trim-highlight"></div>
              <input
                type="range"
                class="range-slider-input no-track"
                id="trim-slider-start"
                min="0"
                max="100"
                value="0"
                step="0.001"
              />
              <input
                type="range"
                class="range-slider-input no-track"
                id="trim-slider-end"
                min="0"
                max="100"
                value="100"
                step="0.001"
              />
            </div>

            <div class="flex-group">
              <div class="flex-col">
                <label>Start</label>
                <input
                  type="number"
                  id="trim-start"
                  value="0"
                  step="0.01"
                  min="0"
                />
              </div>
              <div class="flex-col">
                <label>End</label>
                <input
                  type="number"
                  id="trim-end"
                  value="0"
                  step="0.01"
                  min="0"
                />
              </div>
            </div>
            <div class="button-group">
              <button id="preview-play">Play Loop</button>
              <button id="preview-stop">Stop</button>
            </div>
          </div>

          <div class="controls-grid">
            <div>
              <label>BPM</label>
              <div class="flex-center">
                <input type="number" id="encoder-bpm" value="120" />
                <button id="detect-bpm-btn" class="btn-small">Tap</button>
              </div>

              <label>Pitch (Semitones)</label>
              <input type="number" id="encoder-pitch" value="0" />

              <label>Sample Rate (Hz)</label>
              <div class="flex-center">
                <input
                  type="number"
                  id="encoder-sample-rate-input"
                  value="44100"
                  min="4000"
                  max="48000"
                  step="100"
                />
              </div>
              <label>Sample Rate Slider</label>
              <input
                type="range"
                id="encoder-sample-rate"
                min="4000"
                max="48000"
                step="100"
                value="44100"
              />
              <label>Downsample Mode</label>
              <select id="encoder-resample">
                <option value="resample" selected>
                  Resample (maintain speed, reduce size)
                </option>
                <option value="slow">
                  Transform playback (keep sample count)
                </option>
              </select>
            </div>
            <div>
              <label>Channels</label>
              <select id="encoder-channels">
                <option value="1">Mono</option>
                <option value="2" selected>Stereo</option>
              </select>

              <label>Bit Depth</label>
              <select id="encoder-bit-depth">
                <option value="24">24-bit</option>
                <option value="16" selected>16-bit</option>
                <option value="8">8-bit</option>
              </select>

              <label>Encoding Algorithm</label>
              <select id="encoder-encoding">
                <option value="additive" selected>Additive</option>
                <option value="subtractive">Subtractive</option>
                <option value="difference">Difference</option>
                <option value="noise">Noise</option>
                <option value="additive-columns">Additive: Columns</option>
                <option value="subtractive-columns">
                  Subtractive: Columns
                </option>
                <option value="difference-columns">Difference: Columns</option>
                <option value="noise-columns">Noise: Columns</option>
                <option value="additive-rows">Additive: Rows</option>
                <option value="subtractive-rows">Subtractive: Rows</option>
                <option value="difference-rows">Difference: Rows</option>
                <option value="noise-rows">Noise: Rows</option>
                <option value="additive-quarters">Additive: Quarters</option>
                <option value="subtractive-quarters">
                  Subtractive: Quarters
                </option>
                <option value="difference-quarters">
                  Difference: Quarters
                </option>
                <option value="noise-quarters">Noise: Quarters</option>
              </select>

              <label>Border Width (px)</label>
              <input
                type="number"
                id="encoder-border-width"
                value="1"
                min="1"
              />

              <label>Direction</label>
              <select id="encoder-direction">
                <option value="forward" selected>Forward</option>
                <option value="reverse">Reverse</option>
              </select>

              <label>Image</label>
              <div class="smart-drop-zone" id="encoder-image-drop">
                <button id="encoder-image-btn">Choose Image</button>
                <span id="encoder-image-name" class="file-name"
                  >No image chosen</span
                >
                <input
                  type="file"
                  id="encoder-image-input"
                  accept="image/*"
                  class="hidden"
                />
              </div>
            </div>
          </div>

          <button id="encode-btn" class="controls-header">Encode Image</button>
        </div>

        <div id="generated-controls" class="hidden generated-section">
          <div class="button-row">
            <button id="play-generated-btn">Play Generated Loop</button>
            <button id="stop-generated-btn">Stop</button>
            <button id="download-generated-btn">Download Image</button>
          </div>
          <img id="encoded-image" class="hidden" />
        </div>
      </div>

      <!-- Mixer Panel -->
      <div class="panel hidden" id="panel-mix">
        <div class="drop-zone mixer-container" id="mixer-drop">
          <div class="smart-drop-zone mixer-drop-header" id="mixer-drop-zone">
            <button id="mixer-add-btn">Add Image</button>
            <span class="file-name">Drop images here to add tracks</span>
            <input
              type="file"
              id="mixer-file-input"
              accept="image/*"
              multiple
              class="hidden"
            />
          </div>
          <div id="tracks"></div>
        </div>
      </div>
    </div>

    <script type="module">
      import "./index.ts";
    </script>
  </body>
</html>
