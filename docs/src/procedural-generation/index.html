<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@amplib/procedural-generation</title>
    <style>
      @import "../style.css";
    </style>
  </head>
  <body>
    <header>
      <h1>@amplib/procedural-generation</h1>
    </header>

    <main>
      <section>
        <h2><code>RandomEngine</code></h2>
      </section>
      <section>
        <h3><code>new RandomEngine({ seed: string; size: number })</code></h3>
        <p>Instantiating a RandomEngine with a seed and size.</p>
        <form>
          <label for="seed"
            >Seed <input id="seed" type="text" value="Seed Here" />
          </label>

          <label for="size"
            >Size <input id="size" type="number" min="1" max="10" value="5" />
          </label>
        </form>
        <pre><code>const engine = new RandomEngine({ 
  seed: "<span data-value="seed"></span>", 
  size: <span data-value="size"></span>
});
engine.generation = <span data-output="0-0"></span>
engine.values = <span data-output="0-1"></span></code></pre>
      </section>
      <section>
        <h3><code>engine.step(amount?: number) (default: 1)</code></h3>
        <p>
          Progresses the engine values. By default, this is forward 1, but any
          positive or negative integer can be passed in.
        </p>
        <form>
          <label for="step"
            >Step
            <input id="step" type="number" min="-10" max="10" value="10" />
          </label>
        </form>
        <pre><code>engine.generation = <span data-output="1-0"></span>
engine.step(<span data-value="step"></span>); 
engine.generation = <span data-output="1-1"></span>
engine.values = <span data-output="1-2"></span></code></pre>
      </section>
      <section>
        <h3><code>engine.to(generation: number)</code></h3>
        <p>Moves engine to specific point.</p>
        <form>
          <label for="to"
            >To <input id="to" type="number" min="0" max="1000" value="100" />
          </label>
        </form>
        <pre><code>engine.to(<span data-value="to"></span>);
engine.generation = <span data-output="2-0"></span>
engine.values = <span data-output="2-1"></span></code></pre>
      </section>
      <section>
        <h3>
          <code
            >RandomEngine.timecodeGenerator(settings: Settings): () =>
            Timecode</code
          ><br />
          <code
            >Settings = { length: number; seed: string; seconds: number; }</code
          ><br />
          <code
            >Timecode = { code: string; expiry: number; position: number;
            }</code
          >
        </h3>
        <p>Timecode generator.</p>
        <form>
          <label for="length"
            >Length
            <input id="length" type="number" min="1" max="10" value="5" />
          </label>

          <label for="seconds"
            >Seconds
            <input id="seconds" type="number" min="1" max="60" value="5" />
          </label>
        </form>
        <pre><code>const generator = RandomEngine.timecodeGenerator({ 
  length: <span data-value="length"></span>,
  seconds: <span data-value="seconds"></span>,
  seed: "<span data-value="seed"></span>", 
});
generator() = <span data-output="3-0"></span></code></pre>
      </section>
    </main>

    <script type="module">
      import { RandomEngine } from "../../../packages/amplib-procedural-generation/src";

      run(
        ["length", "seed", "size", "step", "seconds", "to"],
        ({ length, seed, size, step, seconds, to }) => {
          const values = [];
          const engine = new RandomEngine({ seed, size });
          engine.step();
          values[0] = [
            engine.generation,
            JSON.stringify(engine.values, null, 2),
          ];
          values[1] = [engine.generation];
          engine.step(step);
          values[1].push(
            engine.generation,
            JSON.stringify(engine.values, null, 2)
          );
          engine.to(to);
          values[2] = [
            engine.generation,
            JSON.stringify(engine.values, null, 2),
          ];

          const generator = RandomEngine.timecodeGenerator({
            length,
            seconds,
            seed,
          });
          values[3] = [JSON.stringify(generator(), null, 2)];

          values.forEach((group, i) => {
            (group || []).forEach((value, j) => {
              document
                .querySelectorAll(`[data-output="${i}-${j}"]`)
                .forEach((a) => (a.innerText = value));
            });
          });
        }
      );

      function run(ids, onChange) {
        const values = {};
        const elements = {};

        ids.forEach((id) => {
          elements[id] = document.getElementById(id);
        });

        loop();

        function valueFromElement(element) {
          if (element.type === "number") {
            return element.value ? parseInt(element.value) : null;
          } else {
            return element.value || null;
          }
        }

        function loop() {
          requestAnimationFrame(loop);

          ids.forEach((id) => {
            const value = valueFromElement(elements[id]);
            if (value !== values[id]) {
              values[id] = value;
              document
                .querySelectorAll(`[data-value="${id}"]`)
                .forEach((a) => (a.innerText = value));
            }
          });

          onChange(values);
        }
      }
    </script>
  </body>
</html>
