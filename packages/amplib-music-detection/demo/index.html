<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Music Detection</title>
  </head>
  <body>
    <pre></pre>
    <script type="module">
      import { DetectTones } from "../dist/index.js";
      import { UserMediaStream } from "../../amplib-devices/dist/index.js";

      const userMediaStream = new UserMediaStream();

      document.addEventListener("click", async () => {
        const stream1 = await userMediaStream.start({
          audio: true,
        });
        const stream2 = await userMediaStream.start({
          audio: userMediaStream.audioInputDevices[0],
        });

        const audioContext = new AudioContext();
        const detector = new DetectTones({ audioContext });
        const source = audioContext.createMediaStreamSource(stream2);
        await detector.initialize(source);
        detectLoop();

        function detectLoop() {
          requestAnimationFrame(detectLoop);
          document.querySelector("pre").innerHTML = JSON.stringify(
            detector.tick(),
            null,
            2
          );
        }
      });
    </script>
  </body>
</html>
